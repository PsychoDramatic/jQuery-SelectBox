(function(f){f.fn.shrinkWrap=function(j){var i=[];f(this).each(function(){var k=f(this),m=f.browser.msie&&f.browser.msie<8?f("<div style='display:inline;zoom;1'></div>"):f("<div style='display:inline-block;'></div>");if(k.children().size()>0){k.children().wrapAll(m);i.push(m[j]());k.append(m.children());m.remove()}else{var l=k.html();k.html(m.append(l));i.push(m[j]());k.html(l)}});return i.length==1?i[0]:i};Array.max=function(i){return Math.max.apply(Math,i)};Array.min=function(i){return Math.min.apply(Math,i)};var d=Class.extend({init:function(){if(f(window).data("selectboxes")===undefined){f(window).data("selectboxes",{})}},add:function(j,i){f(window).data("selectboxes")[j]=i},remove:function(i){delete f(window).data("selectboxes")[i]},collect:function(j){var i=[],k=f(window).data("selectboxes");f.each(k,function(l,m){if(!j||j.call(m)){i.add(m)}});return i},killAll:function(){f.each(this.collect(),function(j,k){k.close()})},killAllExcept:function(i){f.each(this.collect(),function(j,k){if(k!==i){k.close()}})}});new d();var h=d.prototype;var g=Class.extend({_o:{dropupThreshold:150,fixedWidth:false},_display:null,_dropdown:null,$orig:null,$sb:null,$dd:null,$items:f([]),$enabled:f([]),$disabled:f([]),$optgroups:f([]),isDisabled:false,isOpen:false,context:"body",init:function(j){var i=this;h.add(i);i.$orig=f(i.elem);i.isDisabled=i.$orig.is(":disabled");i._o=f.extend(i._o,j);if(f.isFunction(i._o.context)){i._o.context=i._o.context.call(i.elem)}else{i._o.context=f(i._o.context)}i.$sb=f("<div class='sb'></div>").addClass(i.$orig.attr("class"));f("body").append(i.$sb);i._display=new e(i.$orig);i.$display=i._display.newElem;i.$sb.append(i.$display);i._dropdown=new a(i.$orig);i.$dd=i._dropdown.newElem;i.$sb.append(i.$dd);i._dropdown._root.each(function(m){if(!i.disabled&&!m.disabled){i.$enabled=i.$enabled.add(m.newElem)}if(i.disabled||m.disabled){i.$disabled=i.$disabled.add(m.newElem)}i.$items=i.$items.add(m.newElem)});i.$optgroups=i.$dd.find("li.optgroup");i.$orig.hide();i.$items.filter(":first").addClass("first");i.$items.filter(":last").addClass("last");if(!i._o.fixedWidth){var l=i.$items.add(i.$optgroups.children(".label")),k=l.shrinkWrap("outerWidth");i.$sb.width(Array.max(k))}i.$orig.after(i.$sb);i.$dd.hide();if(!i.isDisabled){}},clickDisplay:function(i){if(this.isOpen){this.close()}else{this.open()}},open:function(){var j,i=this,k=i._o.context;h.killAll();i.isOpen=true;i.$sb.addClass("open");j=i.repositionDropdown();if(j=="down"){i.$dd.slideDown(i._o.animDuration,i.centerOnSelected)}else{i.$dd.fadeIn(i._o.animDuration,i.centerOnSelected)}i.$display.focus()},close:function(){},repositionDropdown:function(){var m=self._o.context,k=self.$display,r=self.$dd,t=0,j=k.offsetFrom(m).left,i=0,n="",s,q,l,u,p,o;r.removeClass("above");r.css({display:"block",maxHeight:"none",position:"relative",visibility:"hidden"});s=f(window).scrollTop()+f(window).height()-k.offset().top-k.outerHeight();q=k.offset().top-f(window).scrollTop();l=k.offsetFrom(m).top+k.outerHeight();u=s-q+self._o.dropupThreshold;if(r.outerHeight()<s){t=s;i=l;n="down"}else{if(r.outerHeight()<q){t=q;i=k.offsetFrom(m).top-Math.min(t,r.outerHeight());n="up"}else{if(u>=0){t=s;i=l;n="down"}else{if(u<0){t=q;i=k.offsetFrom(m).top-Math.min(t,r.outerHeight());n="up"}else{t="none";i=l;n="down"}}}}p=f().jquery<"1.4.2"?f("body").offset().left:parseInt(f("body").css("margin-left"));o=f().jquery<"1.4.2"?f("body").offset().top:parseInt(f("body").css("margin-top"));r.css({display:"none",left:j+(m[0].tagName.toLowerCase()=="body"?p:0),maxHeight:t,position:"absolute",top:i+(m[0].tagName.toLowerCase()=="body"?o:0),visibility:"visible"});if(n=="up"){r.addClass("above")}return n}});var e=Class.extend({arrowMarkup:"<div class='arrow_btn'><span class='arrow_icon'></span></div>",newElem:null,text:"",init:function(j){var i=this;i.text=i.format(j.find(":selected"));i.newElem=i.toDOM()},toDOM:function(){var i=this,k=f("<div class='display'>"+i.text+"</div>"),j=f("<a href='#' class='focus_dummy'>&nbsp;</a>").bind("focus",function(){k.focus()}).bind("blur",function(){k.blur()});return k.append(j).append(f(i.arrowMarkup))},format:function(i){return f(i).html()}});var a=Class.extend({elem:null,$orig:null,$dd:null,_root:null,newElem:null,init:function(j){var i=this;i.$orig=j;i._root=i.build(j);i._root.newElem=i._root.toDOM();i.newElem=i.toDOM()},build:function(k){var i,j=this,l=new c();l.addChildren(k.children());if(k.children().size()==0){i=new b();i.text="&nbsp;";i.selected=true;l.children.push(i)}return l},toDOM:function(){return this._root.newElem.addClass("dropdown")}});var c=Class.extend({elem:null,label:undefined,disabled:false,children:undefined,newElem:null,init:function(k){var i=this;i.elem=k;i.children=[];i.label=null;if(k){var j=f(k);i.disabled=f(k).is(":disabled");i.label=j.attr("label");i.addChildren(j.children());i.newElem=i.toDOM()}return i},toDOM:function(){var n,o,l=this,k,j=f("<div class='label'></div>").html(this.format(this.elem)),m=f("<ul></ul>");f.each(this.children,function(i,p){if(p instanceof c){k=f("<li class='optgroup'></li>").data("class",l);m.append(k.append(p.newElem))}else{m.append(p.newElem)}});if(this.label){return j.add(m)}return m},addChildren:function(j){var i=this;j.each(function(){var k=f(this);if(k.is("optgroup")){i.children.push(new c(k[0]))}else{i.children.push(new b(k[0]))}})},each:function(k){for(var j=0;j<this.children.length;j++){var l=this.children[j];if(l instanceof c){l.each.call(l,k)}else{k.call(this,l)}}},format:function(i){return f(i).attr("label")}});var b=Class.extend({elem:null,value:"",text:"",selected:false,disabled:false,newElem:null,init:function(l,k){if(l){var i=this;var j=f(l);i.elem=l;i.value=j.attr("value")||"";i.text=j.text()||"";i.disabled=j.is(":disabled");i.selected=j.is(":selected");i.newElem=this.toDOM()}},toDOM:function(){return f("<li></li>").data("class",this).html(this.format(this.elem)).addClass(this.selected?"selected":"").addClass(this.disabled?"disabled":"")},format:function(i){return f(i).html()}});f.proto("sb",g)}(jQuery));