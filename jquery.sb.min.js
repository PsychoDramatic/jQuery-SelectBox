/*
  jQuery-SelectBox
  
  Traditional select elements are very difficult to style by themselves, 
  but they are also very usable and feature rich. This plugin attempts to 
  recreate all selectbox functionality and appearance while adding 
  animation and stylability.
  
  This product includes software developed 
  by RevSystems, Inc (http://www.revsystems.com/) and its contributors
  
  Please see the accompanying LICENSE.txt for licensing information.
*/
(function(a){jQuery.fn.borderWidth=function(){return a(this).outerWidth()-a(this).innerWidth()};jQuery.fn.marginWidth=function(){return a(this).outerWidth(true)-a(this).outerWidth()};jQuery.fn.paddingWidth=function(){return a(this).innerWidth()-a(this).width()};jQuery.fn.extraWidth=function(){return a(this).outerWidth(true)-a(this).width()};jQuery.fn.offsetFrom=function(b){return{left:a(this).offset().left-b.offset().left,top:a(this).offset().top-b.offset().top}};jQuery.fn.maxWidth=function(){var b=0;a(this).each(function(){if(a(this).width()>b){b=a(this).width()}});return b};jQuery.fn.sb=function(b){if(a.browser.msie&&a.browser.version<7){return a(this)}b=a.extend({acTimeout:800,animDuration:300,ddCtx:"body",dropupThreshold:150,fixedWidth:false,maxHeight:false,maxWidth:false,selectboxClass:"selectbox",useTie:false,arrowMarkup:"<span class='arrow_btn'><span class='interior'><span class='arrow'></span></span></span>",displayFormat:function(){var c=a(this).attr("label");if(a.trim(c)!=""){return c}return a(this).text()},optionFormat:function(c,e){var d=a(this).attr("label");if(a.trim(d)!=""){return d}return a(this).text()},optgroupFormat:function(c){return"<span class='label'>"+a(this).attr("label")+"</span>"}},b);a(this).each(function(){var f=a(this);var j=null;var k=null;var e=null;var K=null;var D=f.children().size()>0?b.optionFormat.call(f.find("option:selected")[0],0,0):"&nbsp;";function E(){j=a("<div class='sb "+b.selectboxClass+" "+f.attr("class")+"'></div>");a("body").append(j);k=a("<a href='#' class='display "+f.attr("class")+"'><span class='value'>"+f.val()+"</span> <span class='text'>"+D+"</span>"+b.arrowMarkup+"</a>");j.append(k);e=a("<ul class='"+b.selectboxClass+" items "+f.attr("class")+"'></ul>");j.append(e);if(f.children().size()==0){var O=a("<li class='selected empty'><a href='#'><span class='value'></span><span class='text'>&nbsp;</span></a></li>");O.data("val","");e.append(O)}else{f.children().each(function(P){if(a(this).is("optgroup")){var Q=a(this);var R=a("<li class='optgroup'>"+b.optgroupFormat.call(Q[0],P+1)+"</li>");var T=a("<ul class='items'></ul>");R.append(T);e.append(R);Q.children("option").each(function(U){var V=a("<li class='"+(a(this).attr("selected")?"selected":"")+" "+(a(this).attr("disabled")?"disabled":"")+"'><a href='#'><span class='value'>"+a(this).attr("value")+"</span><span class='text'>"+b.optionFormat.call(this,0,P+1)+"</span></a></li>");V.data("val",a(this).attr("value"));T.append(V)})}else{var S=a("<li class='"+(a(this).attr("selected")?"selected":"")+" "+(a(this).attr("disabled")?"disabled":"")+"'><a href='#'><span class='value'>"+a(this).attr("value")+"</span><span class='text'>"+b.optionFormat.call(this,0,P+1)+"</span></a></li>");S.data("val",a(this).attr("value"));e.append(S)}})}K=e.find("li").not(".optgroup");e.children(":first").addClass("first");e.children(":last").addClass("last");f.hide();if(!b.fixedWidth){var N=j.find(".text, .optgroup").maxWidth()+k.extraWidth()+1;j.width(b.maxWidth?Math.min(b.maxWidth,N):N);if(a.browser.msie&&a.browser.version<=7){K.find("a").each(function(){a(this).css("width","100%").width(a(this).width()-a(this).paddingWidth()-a(this).borderWidth())})}}else{if(b.maxWidth&&j.width()>b.maxWidth){j.width(b.maxWidth)}}f.before(j);e.hide();if(!f.is(":disabled")){k.click(C).focus(p).blur(c).hover(H,A);K.not(".disabled").find("a").click(z);K.filter(".disabled").find("a").click(function(){return false});K.not(".disabled").hover(H,A);e.find(".optgroup").hover(H,A).click(function(){return false})}else{j.addClass("disabled");k.click(function(P){P.preventDefault()})}j.bind("close",m);j.bind("destroy",i);f.bind("reload",L);if(jQuery.fn.tie&&b.useTie){f.bind("domupdate",I)}f.focus(g)}function g(){k.focus();return false}var F=null;function I(){clearTimeout(F);F=setTimeout(L,30)}function L(){var O=j.is(".open");var N=k.is(".focused");B();i();E();if(O){k.focus();t()}else{if(N){k.focus()}}}function i(){j.unbind().find("*").unbind();j.remove();f.unbind("reload",L).unbind("domupdate",I).unbind("focus",g).show()}function w(){l();a(document).unbind("click",w)}function l(){a(".sb."+b.selectboxClass).each(function(){a(this).triggerHandler("close")})}function o(){a(".sb."+b.selectboxClass).not(j[0]).each(function(){a(this).triggerHandler("close")})}function m(){if(j.is(".open")){K.removeClass("hover");a(document).unbind("keyup",u);a(document).unbind("keydown",h);a(document).unbind("keydown",n);e.fadeOut(b.animDuration,function(){j.removeClass("open");j.append(e)})}}function B(){K.removeClass("hover");a(document).unbind("keyup",u);a(document).unbind("keydown",h);e.hide();j.removeClass("open");j.append(e)}function x(){var N=null;if(b.ddCtx=="self"){N=j}else{if(a.isFunction(b.ddCtx)){N=a(b.ddCtx.call(f[0]))}else{N=a(b.ddCtx)}}return N}function J(){e.scrollTop(e.scrollTop()+K.filter(".selected").offsetFrom(e).top-e.height()/2+K.filter(".selected").outerHeight(true)/2)}function v(){var O=x();l();j.addClass("open");var N=M();O.append(e);if(a.browser.msie&&a.browser.version<8){a("."+b.selectboxClass+" .display").hide().show()}if(N=="up"){e.fadeIn(b.animDuration,J)}else{if(N=="down"){e.slideDown(b.animDuration,J)}else{e.fadeIn(b.animDuration,J)}}a(document).click(w);k.focus()}function t(){var O=x();l();j.addClass("open");var N=M();O.append(e);if(a.browser.msie&&a.browser.version<8){a("."+b.selectboxClass+" .display").hide().show()}e.show();J();a(document).click(w);k.focus()}function M(){var P=x();var W=0;var O=k.offsetFrom(P).left;var N=0;var R="";e.removeClass("above");e.css({display:"block",maxHeight:"none",position:"relative",visibility:"hidden"});if(!b.fixedWidth){e.width(k.outerWidth()-e.extraWidth()+1)}var V=a(window).scrollTop()+a(window).height()-k.offset().top-k.outerHeight();var U=k.offset().top-a(window).scrollTop();var Q=k.offsetFrom(P).top+k.outerHeight();var X=V-U+b.dropupThreshold;if(e.outerHeight()<V){W=b.maxHeight?b.maxHeight:V;N=Q;R="down"}else{if(e.outerHeight()<U){W=b.maxHeight?b.maxHeight:U;N=k.offsetFrom(P).top-Math.min(W,e.outerHeight());R="up"}else{if(X>=0){W=b.maxHeight?b.maxHeight:V;N=Q;R="down"}else{if(X<0){W=b.maxHeight?b.maxHeight:U;N=k.offsetFrom(P).top-Math.min(W,e.outerHeight());R="up"}else{W=b.maxHeight?b.maxHeight:"none";N=Q;R="down"}}}}var T=a().jquery<"1.4.2"?a("body").offset().left:parseInt(a("body").css("margin-left"));var S=a().jquery<"1.4.2"?a("body").offset().top:parseInt(a("body").css("margin-top"));e.css({display:"none",left:O+(P[0].tagName.toLowerCase()=="body"?T:0),maxHeight:W,position:"absolute",top:N+(P[0].tagName.toLowerCase()=="body"?S:0),visibility:"visible"});if(R=="up"){e.addClass("above")}return R}function C(N){var O=a(this).closest("."+b.selectboxClass);if(O.is(".open")){m()}else{k.focus();v()}return false}function r(){var O=a(this);k.find(".value").html(O.find(".value").html());k.find(".text").attr("title",O.find(".text").html());e.find("li").removeClass("selected");O.closest("li").addClass("selected");var N=f.val();var P=O.closest("li").data("val");f.val(P);k.find(".text").html(b.displayFormat.call(f.find("option:selected")[0]));if(N!=P){f.change()}}function z(N){r.call(this);w();k.focus();return false}var G="";var s=null;function q(){G=""}function d(Q){var R="";var P=K.not(".disabled");for(var O=0;O<P.size();O++){var N=P.eq(O).find(".text").text();R+=N+" ";if(N.toLowerCase().match("^"+Q.toLowerCase())==Q.toLowerCase()){return P.eq(O)}}return null}function y(O){var N=d(O);if(N!=null){r.call(N[0]);return true}return false}function h(N){if(N.which==38||N.which==40||N.which==8||N.which==32){N.preventDefault()}}function n(O){if(O.altKey||O.ctrlKey){return false}var N=K.filter(".selected");switch(O.which){case 35:if(N.size()>0){O.preventDefault();r.call(K.not(".disabled").filter(":last")[0]);J()}break;case 36:if(N.size()>0){O.preventDefault();r.call(K.not(".disabled").filter(":first")[0]);J()}break;case 38:if(N.size()>0){if(K.not(".disabled").filter(":first")[0]!=N[0]){O.preventDefault();r.call(K.not(".disabled").eq(K.not(".disabled").index(N)-1)[0])}J()}break;case 40:if(N.size()>0){if(K.not(".disabled").filter(":last")[0]!=N[0]){O.preventDefault();r.call(K.not(".disabled").eq(K.not(".disabled").index(N)+1)[0]);J()}}else{if(K.size()>1){O.preventDefault();r.call(K.eq(0)[0])}}break;default:break}}function u(O){if(O.altKey||O.ctrlKey){return false}var N=K.filter(".selected");if(O.which!=38&&O.which!=40){G+=String.fromCharCode(O.keyCode);if(!y(G)){clearTimeout(s);q()}else{clearTimeout(s);s=setTimeout(q,b.acTimeout)}}}function p(){o();j.addClass("focused");a(document).unbind("keyup",u).keyup(u);a(document).unbind("keydown",h).keydown(h);a(document).unbind("keydown",n).keydown(n)}function c(){j.removeClass("focused");a(document).unbind("keyup",u);a(document).unbind("keydown",h);a(document).unbind("keydown",n)}function H(){a(this).addClass("hover")}function A(){a(this).removeClass("hover")}E()})}})(jQuery);