/*
  jQuery-SelectBox
  
  Traditional select elements are very difficult to style by themselves, 
  but they are also very usable and feature rich. This plugin attempts to 
  recreate all selectbox functionality and appearance while adding 
  animation and stylability.
  
  This product includes software developed 
  by RevSystems, Inc (http://www.revsystems.com/) and its contributors
  
  Please see the accompanying LICENSE.txt for licensing information.
*/
(function(a){jQuery.fn.borderWidth=function(){return a(this).outerWidth()-a(this).innerWidth()};jQuery.fn.marginWidth=function(){return a(this).outerWidth(true)-a(this).outerWidth()};jQuery.fn.paddingWidth=function(){return a(this).innerWidth()-a(this).width()};jQuery.fn.extraWidth=function(){return a(this).outerWidth(true)-a(this).width()};jQuery.fn.offsetFrom=function(b){return{left:a(this).offset().left-b.offset().left,top:a(this).offset().top-b.offset().top}};jQuery.fn.maxWidth=function(){var b=0;a(this).each(function(){if(a(this).width()>b){b=a(this).width()}});return b};jQuery.fn.sb=function(b){if(a.browser.msie&&a.browser.version<7){return a(this)}b=a.extend({acTimeout:800,animDuration:300,ddCtx:"body",dropupThreshold:150,fixedWidth:false,maxHeight:false,maxWidth:false,selectboxClass:"selectbox",useTie:false,arrowMarkup:"<span class='arrow_btn'><span class='interior'><span class='arrow'></span></span></span>",displayFormat:function(){if(a(this).size()>0){var c=a(this).attr("label");if(a.trim(c)!=""){return c}return a(this).text()}else{return""}},optionFormat:function(c,e){var d=a(this).attr("label");if(a.trim(d)!=""){return d}return a(this).text()},optgroupFormat:function(c){return"<span class='label'>"+a(this).attr("label")+"</span>"}},b);a(this).each(function(){var f=a(this);var k=null;var l=null;var e=null;var K=null;if(f.hasClass("has_sb")){return}else{f.addClass("has_sb")}function E(){var N=f.children().size()>0?b.displayFormat.call(f.find("option:selected")[0],0,0):"&nbsp;";k=a("<div class='sb "+b.selectboxClass+" "+f.attr("class")+"'></div>");a("body").append(k);l=a("<a href='#' class='display "+f.attr("class")+"'><span class='value'>"+f.val()+"</span> <span class='text'>"+N+"</span>"+b.arrowMarkup+"</a>");k.append(l);e=a("<ul class='"+b.selectboxClass+" items "+f.attr("class")+"'></ul>");k.append(e);if(f.children().size()==0){var P=a("<li class='selected empty'><a href='#'><span class='value'></span><span class='text'>&nbsp;</span></a></li>");P.data("val","");e.append(P)}else{f.children().each(function(Q){if(a(this).is("optgroup")){var R=a(this);var S=a("<li class='optgroup'>"+b.optgroupFormat.call(R[0],Q+1)+"</li>");var U=a("<ul class='items'></ul>");S.append(U);e.append(S);R.children("option").each(function(V){var W=a("<li class='"+(a(this).attr("selected")?"selected":"")+" "+(a(this).attr("disabled")?"disabled":"")+"'><a href='#'><span class='value'>"+a(this).attr("value")+"</span><span class='text'>"+b.optionFormat.call(this,0,Q+1)+"</span></a></li>");W.data("val",a(this).attr("value"));U.append(W)})}else{var T=a("<li class='"+(a(this).attr("selected")?"selected":"")+" "+(a(this).attr("disabled")?"disabled":"")+"'><a href='#'><span class='value'>"+a(this).attr("value")+"</span><span class='text'>"+b.optionFormat.call(this,0,Q+1)+"</span></a></li>");T.data("val",a(this).attr("value"));e.append(T)}})}K=e.find("li").not(".optgroup");e.children(":first").addClass("first");e.children(":last").addClass("last");f.hide();if(!b.fixedWidth){var O=k.find(".text, .optgroup").maxWidth()+l.extraWidth()+1;k.width(b.maxWidth?Math.min(b.maxWidth,O):O);if(a.browser.msie&&a.browser.version<=7){K.find("a").each(function(){a(this).css("width","100%").width(a(this).width()-a(this).paddingWidth()-a(this).borderWidth())})}}else{if(b.maxWidth&&k.width()>b.maxWidth){k.width(b.maxWidth)}}f.before(k);e.hide();if(!f.is(":disabled")){l.click(D).focus(q).blur(c).hover(H,B);K.not(".disabled").find("a").click(A);K.filter(".disabled").find("a").click(function(){return false});K.not(".disabled").hover(H,B);e.find(".optgroup").hover(H,B).click(function(){return false})}else{k.addClass("disabled");l.click(function(Q){Q.preventDefault()})}k.bind("close",n);k.bind("destroy",j);f.bind("reload",L);if(jQuery.fn.tie&&b.useTie){f.bind("domupdate",I)}f.focus(g)}function g(){l.focus();return false}var F=null;function I(){clearTimeout(F);F=setTimeout(L,30)}function L(){var O=k.is(".open");var N=l.is(".focused");C();j();E();if(O){l.focus();u()}else{if(N){l.focus()}}}function j(){k.unbind().find("*").unbind();k.remove();f.unbind("reload",L).unbind("domupdate",I).unbind("focus",g).removeClass("has_sb").show()}function x(){m();a(document).unbind("click",x)}function m(){a(".sb."+b.selectboxClass).each(function(){a(this).triggerHandler("close")})}function p(){a(".sb."+b.selectboxClass).not(k[0]).each(function(){a(this).triggerHandler("close")})}function n(){if(k.is(".open")){K.removeClass("hover");a(document).unbind("keyup",v);a(document).unbind("keydown",i);a(document).unbind("keydown",o);e.fadeOut(b.animDuration,function(){k.removeClass("open");k.append(e)})}}function C(){K.removeClass("hover");a(document).unbind("keyup",v);a(document).unbind("keydown",i);e.hide();k.removeClass("open");k.append(e)}function y(){var N=null;if(b.ddCtx=="self"){N=k}else{if(a.isFunction(b.ddCtx)){N=a(b.ddCtx.call(f[0]))}else{N=a(b.ddCtx)}}return N}function J(){e.scrollTop(e.scrollTop()+K.filter(".selected").offsetFrom(e).top-e.height()/2+K.filter(".selected").outerHeight(true)/2)}function w(){var O=y();m();k.addClass("open");var N=M();O.append(e);if(a.browser.msie&&a.browser.version<8){a("."+b.selectboxClass+" .display").hide().show()}if(N=="up"){e.fadeIn(b.animDuration,J)}else{if(N=="down"){e.slideDown(b.animDuration,J)}else{e.fadeIn(b.animDuration,J)}}a(document).click(x);l.focus()}function u(){var O=y();m();k.addClass("open");var N=M();O.append(e);if(a.browser.msie&&a.browser.version<8){a("."+b.selectboxClass+" .display").hide().show()}e.show();J();a(document).click(x);l.focus()}function M(){var P=y();var W=0;var O=l.offsetFrom(P).left;var N=0;var R="";e.removeClass("above");e.css({display:"block",maxHeight:"none",position:"relative",visibility:"hidden"});if(!b.fixedWidth){e.width(l.outerWidth()-e.extraWidth()+1)}var V=a(window).scrollTop()+a(window).height()-l.offset().top-l.outerHeight();var U=l.offset().top-a(window).scrollTop();var Q=l.offsetFrom(P).top+l.outerHeight();var X=V-U+b.dropupThreshold;if(e.outerHeight()<V){W=b.maxHeight?b.maxHeight:V;N=Q;R="down"}else{if(e.outerHeight()<U){W=b.maxHeight?b.maxHeight:U;N=l.offsetFrom(P).top-Math.min(W,e.outerHeight());R="up"}else{if(X>=0){W=b.maxHeight?b.maxHeight:V;N=Q;R="down"}else{if(X<0){W=b.maxHeight?b.maxHeight:U;N=l.offsetFrom(P).top-Math.min(W,e.outerHeight());R="up"}else{W=b.maxHeight?b.maxHeight:"none";N=Q;R="down"}}}}var T=a().jquery<"1.4.2"?a("body").offset().left:parseInt(a("body").css("margin-left"));var S=a().jquery<"1.4.2"?a("body").offset().top:parseInt(a("body").css("margin-top"));e.css({display:"none",left:O+(P[0].tagName.toLowerCase()=="body"?T:0),maxHeight:W,position:"absolute",top:N+(P[0].tagName.toLowerCase()=="body"?S:0),visibility:"visible"});if(R=="up"){e.addClass("above")}return R}function D(N){var O=a(this).closest("."+b.selectboxClass);if(O.is(".open")){n()}else{l.focus();w()}return false}function s(){var O=a(this);l.find(".value").html(O.find(".value").html());l.find(".text").attr("title",O.find(".text").html());e.find("li").removeClass("selected");O.closest("li").addClass("selected");var N=f.val();var P=O.closest("li").data("val");f.val(P);l.find(".text").html(b.displayFormat.call(f.find("option:selected")[0]));if(N!=P){f.change()}}function A(N){s.call(this);x();l.focus();return false}var G="";var t=null;function r(){G=""}function d(Q){var R="";var P=K.not(".disabled");for(var O=0;O<P.size();O++){var N=P.eq(O).find(".text").text();R+=N+" ";if(N.toLowerCase().match("^"+Q.toLowerCase())==Q.toLowerCase()){return P.eq(O)}}return null}function z(O){var N=d(O);if(N!=null){s.call(N[0]);return true}return false}function i(N){if(N.which==38||N.which==40||N.which==8||N.which==32){N.preventDefault()}}function h(S){var O=K.filter(".selected:first");var N=O.find(".text").text().toLowerCase();var R=K.not(".disabled");for(var Q=K.not(".disabled").index(O)+1;Q<R.size();Q++){var P=R.eq(Q).find(".text").text();if(P!=""&&P.substring(0,1).toLowerCase()==S.toLowerCase()){s.call(R.eq(Q)[0]);return true}}return false}function o(O){if(O.altKey||O.ctrlKey){return false}var N=K.filter(".selected");switch(O.which){case 35:if(N.size()>0){O.preventDefault();s.call(K.not(".disabled").filter(":last")[0]);J()}break;case 36:if(N.size()>0){O.preventDefault();s.call(K.not(".disabled").filter(":first")[0]);J()}break;case 38:if(N.size()>0){if(K.not(".disabled").filter(":first")[0]!=N[0]){O.preventDefault();s.call(K.not(".disabled").eq(K.not(".disabled").index(N)-1)[0])}J()}break;case 40:if(N.size()>0){if(K.not(".disabled").filter(":last")[0]!=N[0]){O.preventDefault();s.call(K.not(".disabled").eq(K.not(".disabled").index(N)+1)[0]);J()}}else{if(K.size()>1){O.preventDefault();s.call(K.eq(0)[0])}}break;default:break}}function v(O){if(O.altKey||O.ctrlKey){return false}var N=K.filter(".selected");if(O.which!=38&&O.which!=40){G+=String.fromCharCode(O.keyCode);if(G.length>0&&z(G)){clearTimeout(t);t=setTimeout(r,b.acTimeout)}else{if(h(String.fromCharCode(O.keyCode))){clearTimeout(t);t=setTimeout(r,b.acTimeout)}else{clearTimeout(t);r()}}}}function q(){p();k.addClass("focused");a(document).unbind("keyup",v).keyup(v);a(document).unbind("keydown",i).keydown(i);a(document).unbind("keydown",o).keydown(o)}function c(){k.removeClass("focused");a(document).unbind("keyup",v);a(document).unbind("keydown",i);a(document).unbind("keydown",o)}function H(){a(this).addClass("hover")}function B(){a(this).removeClass("hover")}E()})}})(jQuery);