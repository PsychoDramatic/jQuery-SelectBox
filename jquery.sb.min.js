/*
  jQuery-SelectBox
  
  Traditional select elements are very difficult to style by themselves, 
  but they are also very usable and feature rich. This plugin attempts to 
  recreate all selectbox functionality and appearance while adding 
  animation and stylability.
  
  This product includes software developed 
  by RevSystems, Inc (http://www.revsystems.com/) and its contributors
  
  Please see the accompanying LICENSE.txt for licensing information.
*/
(function(c){c.fn.borderWidth=function(){return c(this).outerWidth()-c(this).innerWidth()};c.fn.paddingWidth=function(){return c(this).innerWidth()-c(this).width()};c.fn.extraWidth=function(){return c(this).outerWidth(true)-c(this).width()};c.fn.offsetFrom=function(g){var f=c(g);return{left:c(this).offset().left-f.offset().left,top:c(this).offset().top-f.offset().top}};c.fn.maxWidth=function(){var e=0;c(this).each(function(){if(c(this).width()>e){e=c(this).width()}});return e};c.fn.triggerAll=function(e,f){return c(this).each(function(){c(this).triggerHandler(e,f)})};var b=Array.prototype.slice;c.proto=function(){var f=arguments[0],e=arguments[1],g=e,h={};opts=c.extend({elem:"elem",access:"access",init:"init"},arguments[2]);if(e._super){h[opts.init]=function(){};g=e.extend(h)}c.fn[f]=function(){var i,j=arguments;c(this).each(function(){var l,k=c(this),m=k.data(f);if(m===undefined){m=new g();if(e._super){m[opts.init]=e.prototype.init}m[opts.elem]=k[0];if(m[opts.init]){m[opts.init].apply(m,b.call(j,0))}k.data(f,m)}else{if(m[opts.access]){m[opts.access].apply(m,b.call(j,0))}if(j.length>0){if(c.isFunction(m[j[0]])){l=m[j[0]].apply(m,b.call(j,1));i=l}else{if(j.length===1){if(c.getObject){i=c.getObject(j[0],m)}else{i=m[j[0]]}}else{if(c.setObject){c.setObject(j[0],j[1],m)}else{m[j[0]]=j[1]}}}}else{if(i===undefined){i=k.data(f)}}}});if(i!==undefined){return c(this)}return i}};var a=function(){return false},d=function(){var k=this,K={},h=null,p=null,q=null,g=null,R=null,M="",z=null,L=null,J,P,i,m,S,O,C,Q,r,T,I,G,B,t,u,e,N,H,E,A,D,x,w,f,F,j,v,y,s,n,l;J=function(){var U;p=c("<div class='sb "+K.selectboxClass+" "+h.attr("class")+"'></div>");c("body").append(p);U=h.children().size()>0?K.displayFormat.call(h.find("option:selected")[0],0,0):"&nbsp;";q=c("<a href='#' class='display "+h.attr("class")+"'></a>").append("<div class='text'>"+U+"</div>").append(K.arrowMarkup);p.append(q);g=c("<ul class='"+K.selectboxClass+" items "+h.attr("class")+"'></ul>");p.append(g);if(h.children().size()===0){g.append(P())}else{h.children().each(function(V){var W,X,Y;if(c(this).is("optgroup")){W=c(this);X=c("<li class='optgroup'>"+K.optgroupFormat.call(W[0],V+1)+"</li>");Y=c("<ul class='items'></ul>");X.append(Y);g.append(X);W.children("option").each(function(){Y.append(P(c(this),V))})}else{g.append(P(c(this),V))}})}R=g.find("li").not(".optgroup");g.children(":first").addClass("first");g.children(":last").addClass("last");h.hide();if(!K.fixedWidth){var o=p.find(".text, .optgroup").maxWidth()+q.extraWidth()+1;p.width(K.maxWidth?Math.min(K.maxWidth,o):o);if(c.browser.msie&&c.browser.version<=7){R.find("a").each(function(){c(this).css("width","100%").width(c(this).width()-c(this).paddingWidth()-c(this).borderWidth())})}}else{if(K.maxWidth&&p.width()>K.maxWidth){p.width(K.maxWidth)}}h.before(p);g.hide();if(!h.is(":disabled")){h.focus(i);q.mousedown(I).click(a).focus(u).blur(e).hover(N,H);D().click(G).hover(N,H);g.find(".optgroup").hover(N,H).click(a);R.filter(".disabled").click(a)}else{p.addClass("disabled");q.click(function(V){V.preventDefault()})}p.bind("close.sb",r).bind("destroy.sb",m);h.bind("reload.sb",S);if(c.fn.tie&&K.useTie){h.bind("domupdate.sb",O)}};P=function(V,o){if(!V){V=c("<option value=''>&nbsp;</option>");o=0}var X=c("<li></li>").data("value",V?V.attr("value"):"").addClass(V.is(":selected")?"selected":"").addClass(V.is(":disabled")?"disabled":""),W=c("<div class='item'></div>"),U=c("<div class='text'></div>").html(K.optionFormat.call(V[0],0,o+1));return X.append(W.append(U))};i=function(){q.focus()};m=function(){p.remove();h.unbind("reload.sb",S).unbind("domupdate.sb",O).unbind("focus.sb",i).removeClass("has_sb").show();h.removeData(k.id)};S=function(){var U=p.is(".open"),o=q.is(".focused");r(true);m();k.init(K);if(U){q.focus();C(true)}else{if(o){q.focus()}}};O=function(){clearTimeout(L);L=setTimeout(S,30)};s=function(){r();c(document).unbind("click",s)};v=function(){c(".sb.open."+K.selectboxClass).triggerAll("close")};n=function(){c(".sb.focused."+K.selectboxClass).not(p[0]).find(".display").blur()};y=function(){c(".sb.open."+K.selectboxClass).not(p[0]).triggerAll("close")};r=function(o){if(p.is(".open")){q.blur();R.removeClass("hover");c(document).unbind("keyup",B).unbind("keydown",l).unbind("keydown",t);if(o===true){g.hide();p.removeClass("open");p.append(g)}else{g.fadeOut(K.animDuration,function(){p.removeClass("open");p.append(g)})}}};E=function(){var o=null;if(K.ddCtx==="self"){o=p}else{if(c.isFunction(K.ddCtx)){o=c(K.ddCtx.call(h[0]))}else{o=c(K.ddCtx)}}return o};A=function(){return R.filter(".selected")};D=function(){return R.not(".disabled")};Q=function(){g.scrollTop(g.scrollTop()+A().offsetFrom(g).top-g.height()/2+A().outerHeight(true)/2)};C=function(U){var o,V=E();n();p.addClass("open");o=T();V.append(g);if(c.browser.msie&&c.browser.version<8){c("."+K.selectboxClass+" .display").hide().show()}if(U===true){g.show();Q()}else{if(o==="down"){g.slideDown(K.animDuration,Q)}else{g.fadeIn(K.animDuration,Q)}}c(document).click(s);q.focus()};T=function(){var V=E(),ac=0,U=q.offsetFrom(V).left,o=0,X="",ab,aa,W,ad,Z,Y;g.removeClass("above");g.css({display:"block",maxHeight:"none",position:"relative",visibility:"hidden"});if(!K.fixedWidth){g.width(q.outerWidth()-g.extraWidth()+1)}ab=c(window).scrollTop()+c(window).height()-q.offset().top-q.outerHeight();aa=q.offset().top-c(window).scrollTop();W=q.offsetFrom(V).top+q.outerHeight();ad=ab-aa+K.dropupThreshold;if(g.outerHeight()<ab){ac=K.maxHeight?K.maxHeight:ab;o=W;X="down"}else{if(g.outerHeight()<aa){ac=K.maxHeight?K.maxHeight:aa;o=q.offsetFrom(V).top-Math.min(ac,g.outerHeight());X="up"}else{if(ad>=0){ac=K.maxHeight?K.maxHeight:ab;o=W;X="down"}else{if(ad<0){ac=K.maxHeight?K.maxHeight:aa;o=q.offsetFrom(V).top-Math.min(ac,g.outerHeight());X="up"}else{ac=K.maxHeight?K.maxHeight:"none";o=W;X="down"}}}}Z=c().jquery<"1.4.2"?c("body").offset().left:parseInt(c("body").css("margin-left"),10);Y=c().jquery<"1.4.2"?c("body").offset().top:parseInt(c("body").css("margin-top"),10);g.css({display:"none",left:U+(V[0].tagName.toLowerCase()==="body"?Z:0),maxHeight:ac,position:"absolute",top:o+(V[0].tagName.toLowerCase()==="body"?Y:0),visibility:"visible"});if(X==="up"){g.addClass("above")}return X};I=function(o){if(p.is(".open")){r()}else{C()}return false};x=function(){var U=c(this),o=h.val(),V=U.data("value");h.val(V);g.find("li").removeClass("selected");U.addClass("selected");q.find(".text").attr("title",U.find(".text").html());q.find(".text").html(K.displayFormat.call(h.find("option:selected")[0]));if(o!==V){h.change()}};G=function(o){x.call(this);s();q.focus();return false};w=function(){M=""};f=function(W){var V,U,X="",o=D();for(V=0;V<o.size();V++){U=o.eq(V).find(".text").text();X+=U+" ";if(U.toLowerCase().match("^"+W.toLowerCase())){return o.eq(V)}}return null};F=function(U){var o=f(U);if(o!==null){x.call(o[0]);return true}return false};l=function(o){if(o.which===38||o.which===40||o.which===8||o.which===32){o.preventDefault()}};j=function(X){var W,V,o=A(),U=D();for(W=U.index(o)+1;W<U.size();W++){V=U.eq(W).find(".text").text();if(V!==""&&V.substring(0,1).toLowerCase()===X.toLowerCase()){x.call(U.eq(W)[0]);return true}}return false};t=function(U){if(U.altKey||U.ctrlKey){return false}var o=A();switch(U.which){case 35:if(o.size()>0){U.preventDefault();x.call(D().filter(":last")[0]);Q()}break;case 36:if(o.size()>0){U.preventDefault();x.call(D().filter(":first")[0]);Q()}break;case 38:if(o.size()>0){if(D().filter(":first")[0]!==o[0]){U.preventDefault();x.call(D().eq(D().index(o)-1)[0])}Q()}break;case 40:if(o.size()>0){if(D().filter(":last")[0]!==o[0]){U.preventDefault();x.call(D().eq(D().index(o)+1)[0]);Q()}}else{if(R.size()>1){U.preventDefault();x.call(R.eq(0)[0])}}break;default:break}};B=function(o){if(o.altKey||o.ctrlKey){return false}if(o.which!==38&&o.which!==40){M+=String.fromCharCode(o.keyCode);if(F(M)){clearTimeout(z);z=setTimeout(w,K.acTimeout)}else{if(j(String.fromCharCode(o.keyCode))){Q();clearTimeout(z);z=setTimeout(w,K.acTimeout)}else{w();clearTimeout(z)}}}};u=function(){y();p.addClass("focused");c(document).unbind("keyup",B).keyup(B).unbind("keydown",l).keydown(l).keydown(t).unbind("keydown",t).keydown(t)};e=function(){p.removeClass("focused");c(document).unbind("keyup",B).unbind("keydown",l).unbind("keydown",t)};N=function(){c(this).addClass("hover")};H=function(){c(this).removeClass("hover")};this.init=function(o){if(c.browser.msie&&c.browser.version<7){return}h=c(this.elem);if(h.hasClass("has_sb")){return}else{h.addClass("has_sb")}K=c.extend({acTimeout:800,animDuration:200,ddCtx:"body",dropupThreshold:150,fixedWidth:false,maxHeight:false,maxWidth:false,selectboxClass:"selectbox",useTie:false,arrowMarkup:"<span class='arrow_btn'><span class='interior'><span class='arrow'></span></span></span>",displayFormat:function(){if(c(this).size()>0){var U=c(this).attr("label");if(U!==""){return U}return c(this).text()}else{return""}},optionFormat:function(U,W){var V=c(this).attr("label");if(V!==""){return V}return c(this).text()},optgroupFormat:function(U){return"<span class='label'>"+c(this).attr("label")+"</span>"}},o);J()};this.open=C;this.close=r;this.refresh=S;this.destroy=m;this.options=function(o){K=c.extend(K,o);S()}};c.proto("sb",d)}(jQuery));