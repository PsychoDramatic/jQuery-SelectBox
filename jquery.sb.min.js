/*
  jQuery-SelectBox
  
  Traditional select elements are very difficult to style by themselves, 
  but they are also very usable and feature rich. This plugin attempts to 
  recreate all selectbox functionality and appearance while adding 
  animation and stylability.
  
  This product includes software developed 
  by RevSystems, Inc (http://www.revsystems.com/) and its contributors
  
  Please see the accompanying LICENSE.txt for licensing information.
*/
(function(a){jQuery.fn.borderWidth=function(){return a(this).outerWidth()-a(this).innerWidth()};jQuery.fn.marginWidth=function(){return a(this).outerWidth(true)-a(this).outerWidth()};jQuery.fn.paddingWidth=function(){return a(this).innerWidth()-a(this).width()};jQuery.fn.extraWidth=function(){return a(this).outerWidth(true)-a(this).width()};jQuery.fn.offsetFrom=function(b){return{left:a(this).offset().left-b.offset().left,top:a(this).offset().top-b.offset().top}};jQuery.fn.maxWidth=function(){var b=0;a(this).each(function(){if(a(this).width()>b){b=a(this).width()}});return b};jQuery.fn.sb=function(b){if(a.browser.msie&&a.browser.version<7){return a(this)}b=a.extend({acTimeout:800,animDuration:300,ddCtx:"body",dropupThreshold:150,fixedWidth:true,maxHeight:false,maxWidth:false,noScrollThreshold:100,placement:"before",selectboxClass:"selectbox",useTie:false,arrowMarkup:"<span class='arrow_btn'><span class='interior'><span class='arrow'></span></span></span>",optionFormat:function(c,d){return a(this).text()},optgroupFormat:function(c){return"<span class='label'>"+a(this).attr("label")+"</span>"}},b);a(this).each(function(){var q=a(this);var J=null;var k=null;var E=null;var g=null;function p(){J=a("<div class='"+b.selectboxClass+" "+q.attr("class")+"'></div>");a("body").append(J);k=a("<a href='#' class='display "+q.attr("class")+"'><span class='value'>"+q.val()+"</span> <span class='text'>"+b.optionFormat.call(q.find("option:selected")[0],0,0)+"</span>"+b.arrowMarkup+"</a>");J.append(k);E=a("<ul class='items "+q.attr("class")+"'></ul>");J.append(E);q.children().each(function(L){if(a(this).is("optgroup")){var M=a(this);var N=a("<li class='optgroup'>"+b.optgroupFormat.call(M[0],L+1)+"</li>");var P=a("<ul class='items'></ul>");N.append(P);E.append(N);M.children("option").each(function(Q){var R=a("<li class='"+(a(this).attr("selected")?"selected":"")+" "+(a(this).attr("disabled")?"disabled":"")+"'><a href='#'><span class='value'>"+a(this).attr("value")+"</span><span class='text'>"+b.optionFormat.call(this,L+1,Q+1)+"</span></a></li>");R.data("val",a(this).attr("value"));P.append(R)})}else{var O=a("<li class='"+(a(this).attr("selected")?"selected":"")+" "+(a(this).attr("disabled")?"disabled":"")+"'><a href='#'><span class='value'>"+a(this).attr("value")+"</span><span class='text'>"+b.optionFormat.call(this,0,L+1)+"</span></a></li>");O.data("val",a(this).attr("value"));E.append(O)}});g=E.find("li").not(".optgroup");E.children(":first").addClass("first");E.children(":last").addClass("last");q.hide();if(b.fixedWidth){var K=J.find(".text, .optgroup").maxWidth()+k.extraWidth()+1;J.width(b.maxWidth?Math.min(b.maxWidth,K):K);if(a.browser.msie&&a.browser.version<=7){g.find("a").each(function(){a(this).css("width","100%").width(a(this).width()-a(this).paddingWidth()-a(this).borderWidth())})}}else{if(b.maxWidth&&J.width()>b.maxWidth){J.width(b.maxWidth)}}if(b.placement=="before"){q.before(J)}else{if(b.placement=="after"){q.after(J)}}E.hide();if(!q.is(":disabled")){k.click(H).focus(c).blur(I).hover(G,x);g.not(".disabled").find("a").click(h);g.filter(".disabled").find("a").click(function(){return false});g.not(".disabled").hover(G,x);E.find(".optgroup").hover(G,x)}else{J.addClass("disabled");k.click(function(L){L.preventDefault()})}J.bind("close",z);J.bind("destroy",d);q.bind("reload",B);if(jQuery.fn.tie&&b.useTie){q.bind("domupdate",v)}q.focus(D)}function D(){k.focus();return false}var w=null;function v(){clearTimeout(w);w=setTimeout(B,30)}function B(){var K=J.is(".open");s();d();p();if(K){k.focus();t()}}function d(){J.unbind().find("*").unbind();J.remove();q.unbind("reload",B).unbind("domupdate",v).unbind("focus",D).show()}function r(){e();a(document).unbind("click",r)}function e(){a("."+b.selectboxClass).trigger("close")}function C(){a("."+b.selectboxClass).not(J[0]).trigger("close")}function z(){g.removeClass("hover");a(document).unbind("keyup",o);a(document).unbind("keydown",i);E.fadeOut(b.animDuration,function(){J.removeClass("open");J.append(E)})}function s(){g.removeClass("hover");a(document).unbind("keyup",o);a(document).unbind("keydown",i);E.hide();J.removeClass("open");J.append(E)}function m(){var K=null;if(b.ddCtx=="self"){K=J}else{if(a.isFunction(b.ddCtx)){K=a(b.ddCtx.call(q[0]))}else{K=a(b.ddCtx)}}return K}function u(){var M=m();e();J.addClass("open");var K=y();M.append(E);function L(){E.scrollTop(g.filter(".selected").offsetFrom(E).top-E.height()/2+g.filter(".selected").outerHeight(true)/2)}if(a.browser.msie&&a.browser.version<8){a("."+b.selectboxClass+" .display").hide().show()}if(K=="up"){E.fadeIn(b.animDuration,L)}else{if(K=="down"){E.slideDown(b.animDuration,L)}else{E.fadeIn(b.animDuration,L)}}a(document).unbind("keyup",o).keyup(o);a(document).unbind("keydown",i).keydown(i);a(document).click(r)}function t(){var M=m();e();J.addClass("open");var K=y();M.append(E);function L(){E.scrollTop(g.filter(".selected").offsetFrom(E).top-E.height()/2+g.filter(".selected").outerHeight(true)/2)}if(a.browser.msie&&a.browser.version<8){a("."+b.selectboxClass+" .display").hide().show()}E.show();L();a(document).unbind("keyup",o).keyup(o);a(document).unbind("keydown",i).keydown(i);a(document).click(r)}function y(){var L=m();var S=0;var K=0;var N="";E.removeClass("above");E.css({display:"block",maxHeight:"none",position:"relative",visibility:"hidden"});if(b.fixedWidth){E.width(k.outerWidth()-E.extraWidth()+1)}var R=a(window).scrollTop()+a(window).height()-k.offset().top-k.outerHeight();var Q=k.offset().top-a(window).scrollTop();var M=k.offsetFrom(L).top+k.outerHeight();var T=R-Q+b.dropupThreshold;if(E.outerHeight()<R){S=b.maxHeight?b.maxHeight:R;K=M;N="down"}else{if(E.outerHeight()<Q){S=b.maxHeight?b.maxHeight:Q;K=k.offsetFrom(L).top-Math.min(S,E.outerHeight());N="up"}else{if(T>=0){S=b.maxHeight?b.maxHeight:R;K=M;N="down"}else{if(T<0){S=b.maxHeight?b.maxHeight:Q;K=k.offsetFrom(L).top-Math.min(S,E.outerHeight());N="up"}else{S=b.maxHeight?b.maxHeight:"none";K=M;N="down"}}}}var P=a().jquery<"1.4.2"?a("body").offset().left:parseInt(a("body").css("margin-left"));var O=a().jquery<"1.4.2"?a("body").offset().top:parseInt(a("body").css("margin-top"));E.css({display:"none",left:k.offsetFrom(L).left+(L[0].tagName.toLowerCase()=="body"?P:0),maxHeight:S,position:"absolute",top:K+(L[0].tagName.toLowerCase()=="body"?O:0),visibility:"visible"});if(N=="up"){E.addClass("above")}return N}function H(K){var L=a(this).closest("."+b.selectboxClass);if(L.is(".open")){z();k.focus()}else{k.focus();u()}return false}function n(){var K=a(this);k.find(".value").html(K.find(".value").html());k.find(".text").html(K.find(".text").html());k.find(".text").attr("title",K.find(".text").html());E.find("li").removeClass("selected");K.closest("li").addClass("selected");q.val(K.closest("li").data("val")).change()}function h(K){n.call(this);r();k.focus();return false}var F="";var j=null;function f(){F=""}function A(N){var O="";var M=g.not(".disabled");for(var L=0;L<M.size();L++){var K=M.eq(L).find(".text").text();O+=K+" ";if(K.toLowerCase().match("^"+N.toLowerCase())==N.toLowerCase()){return M.eq(L)}}return null}function l(L){var K=A(L);if(K!=null){n.call(K[0]);return true}return false}function i(K){if(K.which==38||K.which==40||K.which==8||K.which==32){K.preventDefault()}}function o(L){if(L.altKey||L.ctrlKey){return false}var K=g.filter(".selected");switch(L.which){case 38:if(K.size()>0){if(g.not(".disabled").filter(":first")[0]!=K[0]){n.call(g.not(".disabled").eq(g.not(".disabled").index(K)-1)[0])}}break;case 40:if(K.size()>0){if(g.not(".disabled").filter(":last")[0]!=K[0]){n.call(g.not(".disabled").eq(g.not(".disabled").index(K)+1)[0])}}else{if(g.size()>1){n.call(g.eq(0)[0])}}break;default:F+=String.fromCharCode(L.keyCode);if(!l(F)){clearTimeout(j);f()}else{clearTimeout(j);j=setTimeout(f,b.acTimeout)}break}return false}function c(){C();J.addClass("focused");if(!J.is(".open")){a(document).unbind("keyup",o).keyup(o);a(document).unbind("keydown",i).keydown(i)}}function I(){J.removeClass("focused");a(document).unbind("keyup",o);a(document).unbind("keydown",i)}function G(){a(this).addClass("hover")}function x(){a(this).removeClass("hover")}p()})}})(jQuery);